#!/bin/sh
function upmenu {
        options="Upload a File\nRecent Uploads"
        selected=$(echo -e $options | rofi -dmenu)
		if [[ "$selected" == "Upload a File" ]]; then
		
		target="$1"
		[ -z "$target" ] && target="$(realpath .)"

ls() {
        echo ..
        command ls -ALpX1 --group-directories-first "$target"
}

		while :; do
		        sel="$(ls | rofi -dmenu)" || exit
		        if [ "$(echo "$sel")" = "/" ]; then
		                newt="$sel"
		        else
		                newt="$(realpath "$target/$sel")"
		        fi
		        if [ -e "$newt" ]; then
		                target="$newt"
		                if [ ! -d "$target" ]; then
		                        echo "Location: $target"
								command="curl -s -F'file=@$target' https://0x0.st"
               					echo "Executing: $command"

               					url=$(eval $command)
              					echo "URL: $url"

              					printf "$url" | xclip -sel clip
             					notify-send "File Uploaded\nURL: $url" 

               					entry="$(date '+%d-%m-%y-%H:%M:%S')    $url    $(echo $target | awk -F'/' '{print $(NF)}')"
             					echo $entry >> $HOME/.0x0_list
             					echo "Uploaded"; break
		                fi
		        fi
		done
		elif [[ "$selected" == "Recent Uploads" ]]; then
                    var=$(tac ~/.0x0_list | rofi -dmenu)
                    filename=$(echo $var | awk '{print $3}')
                    url=$(echo $var | awk '{print $2}')
                    printf "$url" | xclip -sel clip
                   notify-send "$filename\nURL: $url"
		elif [[ "$selected" == "ÔÅ† Voltar" ]]; then
					exit
				fi
}

upmenu
